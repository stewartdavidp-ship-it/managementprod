Command Center ‚Äî Release Notes
================================

v8.18.3 ‚Äî 2026-02-09
--------------------
Fix: Firebase overlay was overwriting locally-migrated repos.

Root cause: startup overlay pulled Firebase config (empty repos)
and overlaid it onto local config (which had repos from
cc_apps_v6 migration), erasing the repo assignments.

Overlay now preserves locally-populated repos when Firebase
has empty strings, then pushes the corrected config back to
Firebase automatically. Also added diagnostic logging to
migrateFromOldFormat.

v8.18.2 ‚Äî 2026-02-09
--------------------
Fix: Auto-detected repos not synced to config/Firebase.

autoMapRepos() wrote testRepo/prodRepo to legacy apps state
(cc_apps_v6) but never back to config.apps[id].repos. This
meant Firebase config had empty repo strings, and the hosted
Dashboard filtered out apps without repos.

Now syncs detected repos back to config after auto-mapping,
so Push All includes correct repo assignments.

v8.18.1 ‚Äî 2026-02-09
--------------------
Fix: Apps missing project field after Firebase sync.

mergeWithDefaults() schema migration was missing the project
field, so apps synced from Firebase without it defaulted to
'other'. Dashboard showed all apps under "Other" project.

Added project backfill from DEFAULT_APP_DEFINITIONS seeds
during migration. Existing apps get their correct project
assignment restored automatically on load.

v8.18.0 ‚Äî 2026-02-09
--------------------
Firebase Sync Settings UI + Debounced Writes

New "Firebase Config Sync" section in Settings view with:
- Sync status display (synced/syncing/offline/error)
- Firebase data size with per-key breakdown
- Manual "Push All to Firebase" button (force overwrite)
- Manual "Pull All from Firebase" button (force overlay)
- "Clear Firebase Data" button (with confirmation)
- Last manual sync timestamp

Debounced writes: deploy history, session log, and deletion
history now use 2-second debounce window to prevent rapid-fire
writes to Firebase RTDB during batch deploy operations.

New FirebaseConfigSync methods: clearAll() removes all CC data
from Firebase, getDataSize() measures data per key.

v8.17.0 ‚Äî 2026-02-09
--------------------
Firebase Config Sync ‚Äî CC data now syncs to Firebase RTDB.

New FirebaseConfigSync class syncs non-sensitive configuration
data to Firebase at command-center/ path. localStorage remains
the instant-load cache; Firebase is the source of truth.

Dual-write: every save writes localStorage first (instant),
then fire-and-forget pushes to Firebase RTDB.

Startup overlay: loads localStorage immediately, pulls Firebase
async, overlays into state if Firebase data is newer. On first
run (Firebase empty), seeds Firebase with all local data.

Sync status indicator in header shows connection state:
‚òÅÔ∏è synced | üîÑ syncing | ‚ö° offline | ‚ö†Ô∏è error

Data synced: config (apps/projects/environments), deploy
history, rules history, session log, deletion history,
rollback snapshots.

Secrets stay local only: GitHub PAT, Firebase SA key, API keys,
collapsed projects (UI preference), Firebase UID (session).

Foundation for future multi-user access to CC configuration.

--- REMAINING WORK (next session) ---
- Firebase security rules for command-center/ path
- Settings UI: manual push/pull buttons, sync status details
- Sync conflict resolution UI (currently last-write-wins)
- Test with actual multi-device scenario

v8.16.7 ‚Äî 2026-02-09
--------------------
Google auth moved from Firebase page to header status bar.
Shows profile photo + first name when signed in, "Sign In"
when not. Click signed-in user to sign out. Greyed out when
running locally (HTTPS required).

v8.16.6 ‚Äî 2026-02-09
--------------------
Hide top "Scan Repositories" button when on Repo Reset tab
to avoid confusion between the two scan buttons.

v8.16.5 ‚Äî 2026-02-09
--------------------
Repo Reset reworked as bulk scanner. "Scan All Repos" checks
all recently-deployed apps (test + prod) at once. Results
grouped by app/repo. Select All + Delete handles files and
directories recursively. Auto re-scans after cleanup.

v8.16.4 ‚Äî 2026-02-09
--------------------
FIX: React Error #310 on Repo Reset tab. Extracted from IIFE
(useState hooks illegal there) into proper RepoResetPanel component.

v8.16.3 ‚Äî 2026-02-09
--------------------
FIX: "Running Locally" banner link was hardcoded to old
managementprod repo (404). Now dynamically reads prod repo URL
from command-center app config.

v8.16.2 ‚Äî 2026-02-09
--------------------
FIX: Health alert "Open Repo Reset" now lands on the Repo Reset
tab (was landing on Stale Files). Also dismisses the alert banner.

v8.16.1 ‚Äî 2026-02-09
--------------------
Health check now only scans apps deployed in the last 30 days.
Reads deployment history from localStorage to determine which
apps are active. Reduces API calls from ~40 to just the repos
you're actively using.

v8.16.0 ‚Äî 2026-02-09
--------------------
FEATURE: Daily Repo Health Check

On startup (after version refresh), CC now scans all app repos
for unexpected files ‚Äî runs once per 24 hours.

If issues found, an amber banner appears at the top of Dashboard:
  ‚ö†Ô∏è Repo Health Check ‚Äî 2 repos with unexpected files
  üèóÔ∏è Command Center (test) ‚Äî 3 unexpected: command-center/, docs/...
  üéÆ Game Shelf (prod) ‚Äî 1 unexpected: old-backup.html

Buttons:
- "Open Repo Reset" ‚Üí navigates to Cleanup ‚Üí Repo Reset tab
- "‚úï Dismiss" ‚Üí hides banner until next daily check

The check is lightweight (root-level listRepoContents only, no
recursive scan). The Repo Reset tool does the full recursive scan
when you want to see details and delete files.

v8.15.6 ‚Äî 2026-02-09
--------------------
FIX: HTML Deploy Path from Zip
FEATURE: Repo Reset Tool

Deploy fix: HTML files from zips with nested folders were deploying
to the wrong path (e.g. command-center/index.html instead of
index.html). Now HTML files always use filename-only as targetPath.
This also fixes promotion reading wrong versions from test repos.

Repo Reset: New tab in Cleanup view.
1. Select app + target (test/prod)
2. Scan ‚Äî fetches all repo contents recursively
3. Compares against expected structure:
   - Simple apps: index.html
   - PWA apps: index.html, sw.js, manifest.json, icons/
   - Prod repos also: doc files at root
   - Always expected: README.md, LICENSE, .gitignore, CNAME
4. Shows summary cards: expected / unexpected / total
5. Select All + delete unexpected files
6. Deletion log with per-file success/failure

v8.15.5 ‚Äî 2026-02-09
--------------------
FIX: setStagedFiles Scoping Error

Root cause of "Push 6 Docs" reappearing after deploy.

setStagedFiles was defined in App() but called inside DashboardView
(a child component) without being passed as a prop. The batch deploy
executeBatchAction pushed docs successfully to GitHub, but the
setStagedFiles call threw ReferenceError, leaving the docs in the
staged files list.

Fix: Pass setStagedFiles as prop from App to DashboardView.

v8.15.4 ‚Äî 2026-02-09
--------------------
UX: Drift Banner Auto-Collapse

Config drift banner is now a <details> element:
- Errors/warnings: auto-opens, red/orange styling, Copy Fix Prompt visible
- Info-only: collapsed one-liner with slate styling, click to expand
- Reduces visual noise for non-critical drift items

v8.15.3 ‚Äî 2026-02-09
--------------------
FIX: Doc Push Bugs

Bug 1: After pushing docs, the staged files weren't cleared,
causing the UI to show "Push 6 Docs" again and push them twice.
Now successfully pushed docs are removed from staged files.

Bug 2: Standalone repos (no subPath like CC) had docs pushed to
wrong paths like command-center/CONTEXT.md instead of CONTEXT.md.
The default docTargetPath now correctly uses just the fileName.

Both fixes applied to batch deploy controls AND Deploy All modal.

v8.15.2 ‚Äî 2026-02-09
--------------------
FIX: Seed Drift + Copy Buttons

Fixed 3 config ‚Üî code drift items detected by v8.15.1:
- Quotle icon: üìñ ‚Üí üí¨ (manifest + definitions)
- quotle-info project name: Quotle.info ‚Üí Quotle-info (manifest + seeds + definitions)
- Command Center appType: internal ‚Üí public (manifest + definitions)

Added üìã Copy button inside the expanded prompt text for both
doc validation and config drift banners.

v8.15.1 ‚Äî 2026-02-09
--------------------
FEATURE: Config ‚Üî Code Drift Detection

When deploying CC itself, the new version's seed values are compared
against the running config to detect mismatches.

How it works:
1. CC_SEED_MANIFEST is a JSON block embedded in index.html between
   /* CC_SEED_MANIFEST_START */ and /* CC_SEED_MANIFEST_END */ markers
2. detectConfigDrift() parses it from the staged file and diffs against
   the running config (localStorage)
3. Drifts are classified:
   - üî¥ Error: gs-app-id doesn't match any config app
   - ‚ö†Ô∏è Warn: project/app name, project assignment, etc. mismatch
   - ‚ÑπÔ∏è Info: apps/projects in config but not in code seeds

UI:
- Color-coded banner appears in staged files area (only on CC self-deploy)
- "Copy Fix Prompt" button copies detailed Claude prompt with all drifts
- Expandable prompt shows exactly what to tell Claude to fix

This ensures that when you edit app/project config in the CC UI,
you get alerted if the code's seed values don't match.

v8.15.0 ‚Äî 2026-02-09
--------------------
BREAKING: App Identity Rename (management ‚Üí command-center)

Command Center is now a standalone app with its own identity.
Previously it was "management" ‚Äî a sub-app under Game Shelf.

Changes:
- gs-app-id meta tag: "command-center" (was "management")
- Page title: "Command Center" (was "Game Shelf Command Center")
- DEFAULT_APP_DEFINITIONS key/id: "command-center"
- Fallback detection signature: "command-center"
- Default deploy target: "command-center"
- Repo-to-app-id mappings: both Smart Deploy + Claude Prep
- Internal tools list in Projects view
- Deploy instructions: references command-center-test repo

Migration:
- mergeWithDefaults() auto-renames "management" ‚Üí "command-center"
  in localStorage on first load of v8.15.0
- Old deployment history still displays correctly (read-only)

v8.14.2 ‚Äî 2026-02-09
--------------------
FIX: Deploy + Docs UX

- Batch deploy controls now show "Deploy 1 file + Push 6 docs" (was "Deploy 7 selected files")
- Doc files from zip now inherit the detected app from index.html
- Single button click deploys to GitHub Pages AND pushes docs to source repo
- Refactored batch action handler to eliminate code duplication

v8.14.1 ‚Äî 2026-02-09
--------------------
FEATURE: Doc Package Validation

When deploy + doc files are staged together, CC now validates:
1. Missing required docs (CONTEXT.md, PROJECT_PLAN.md, CHANGELOG.md, RELEASE_NOTES.txt)
2. CONTEXT.md version header matches deploy version
3. CHANGELOG.md latest [X.X.X] entry matches deploy version
4. RELEASE_NOTES.txt latest entry matches deploy version

UI:
- Amber "Doc Package Issues" banner above staged files with all issues listed
- Expandable "Show Claude fix prompt" with ready-to-paste text
- "Copy Fix Prompt" button for one-click copy
- Per-file green ‚úì or amber ‚ö†Ô∏è indicators on each doc card

The Claude fix prompt includes specific file names, expected versions,
and what action to take (create missing docs, update version references).

v8.14.0 ‚Äî 2026-02-09
--------------------
FEATURE: Unified Deploy + Push Docs

Drop a project zip (e.g. cc-project-v8_14_0.zip) and CC automatically:
- Routes index.html/sw.js/manifest.json ‚Üí deploy to GitHub Pages
- Routes CONTEXT.md/CHANGELOG.md/etc ‚Üí push to source repo
- SESSION_BRIEF.md auto-skipped (it's auto-generated)

New in staged files:
- Doc files (.md, .txt) show cyan "Push to repo:" label
- Deploy files show normal "Deploy as:" label
- Both types selectable/deselectable individually

Deploy All modal:
- Files grouped into "Deploy to GitHub Pages" and "Push docs to repo" sections
- Adaptive button text: "Deploy 1 + Push 6 Docs"
- Docs pushed via GitHub API with SHA check for updates vs creates

Also: file input now accepts .md and .txt files, drop zone hint updated.

v8.13.2.0 ‚Äî 2026-02-09
--------------------
ARCHITECTURE: Config as Source of Truth

mergeWithDefaults() overhaul:
- Seed data (DEFAULT_APP_DEFINITIONS, SEED_PROJECTS) now only used for first-time init
- Stored config.apps and config.projects are authoritative after first load
- No more force-merging defaults into existing stored data on every load
- Schema migration only: ensures structural fields exist without overwriting values

Removed DEFAULT_APP_DEFINITIONS runtime fallbacks:
- 8 subPath fallback references removed (deploy, Smart Deploy, version check, Projects)
- PWA detection now reads from config.apps instead of hardcoded defaults
- targetPath lookup now reads from config.apps
- repoPatterns for auto-env-selection now reads from config.apps
- appWithDefaults spread removed from deploy function

This prevents hardcoded seed values from overriding user customizations
(e.g., Command Center project assignment reverting to Game Shelf on reload).

v8.13.1.7 ‚Äî 2026-02-09
--------------------
CHANGE: Command Center Project Independence
- Added "Command Center" project to SEED_PROJECTS (üèóÔ∏è, cyan)
- Updated management app default: project 'command-center' (was 'gameshelf')
- Updated repoPatterns: command-center / command-center-test (was management-prod)
- Added repos.test to management app definition
- Icon updated from üéõÔ∏è to üèóÔ∏è to match user config

v8.13.1.6 ‚Äî 2026-02-09
--------------------
FIX: Version Scanner False Positives on CC Self-Deploy
- Extracted SEED_VERSION constant for new app scaffolding (generateInitialHTML, generateAdminHTML)
  Previously hardcoded "0.1.0" in template HTML triggered "Version Issues Detected"
- Enhanced shouldSkip() in findAllVersionStrings():
  - Detects meta version tags inside generate*() functions (1000-char lookback)
  - Skips placeholder patterns (X.X.X, X.Y.Z) as non-version strings
- CC now deploys cleanly with single version (8.13.1.6) detected

v8.13.1.5 ‚Äî 2026-02-07
--------------------
FEATURE: Push Docs to Repo + Detection Improvements

Push Docs (v8.13.1.0-1.3):
- New "Push Docs to Repo" feature in Claude Prep modal
- Drop .md/.txt files or .zip packages ‚Äî extracts docs automatically
- Checks repo for existing files (update vs create), pushes via GitHub API
- Clear progress states: staging ‚Üí animated pushing ‚Üí completion/error banner
- Zip support: drops a project zip, all docs extracted and deduplicated

Extra Docs Scanning (v8.13.1.4):
- Claude Prep now scans repo for additional .md files beyond the standard 4
- Follows CLAUDE-PREP-STANDARD: extras included when present in repo

App Configuration (v8.13.0.4-0.8):
- Sub Path field in app edit modal for subdirectory apps
- Repository Assignment dropdowns ‚Äî select from real repos instead of typing
- Repos grouped as Shared (with app labels) vs Available
- Projects promoted to main navigation (5 tabs)
- Emoji picker on both App and Project edit modals
- Auto-generated detection patterns from app name
- Dynamic app detection ‚Äî configurable patterns scored by specificity

v8.13.0 ‚Äî 2025-02-07
--------------------
FEATURE: Claude Prep (Session Prep per App)
- New ü§ñ button on each app row in Projects & Apps view
- Click to generate a context package for starting a Claude session:
  - Fetches source files from GitHub repo (index.html + sw.js/manifest.json for PWAs)
  - Fetches project docs (CONTEXT.md, PROJECT_PLAN.md, CHANGELOG.md, RELEASE_NOTES.txt, ARCHITECTURE.md)
  - Generates SESSION_BRIEF.md with current versions, recent deploys, open issues
  - Packages everything into a downloadable zip
- Smart doc detection: standalone repos check root, consolidated repos check {subPath}/docs/
- Bootstrap mode: generates skeleton doc templates when docs don't exist yet
- Progress modal with real-time log, file manifest, and download button

v8.12.0 ‚Äî 2025-02-07
--------------------
FEATURE: Projects as Stored Data (Priority 1)
- Projects promoted from hardcoded constant to stored objects in config
- New ProjectEditModal: create, edit, delete projects
  - Name, icon (emoji or gs-logo), color picker (7 themes), description, sort order
  - Delete with app reassignment to Other project
- "_standalone" concept removed, replaced with "Other" project
- New Project button in ProjectsTab header
- Edit button (‚úèÔ∏è) on each project card
- Project state (active/hidden) now stored in config instead of separate localStorage
- All project dropdowns (AppEditModal, SetupNewAppView) read from config
- Auto-migration: seeds projects from SEED_PROJECTS on first load,
  migrates _standalone ‚Üí other, migrates cc_projectStates into config

v8.11.0 ‚Äî 2025-02-07
--------------------
FEATURE: Functions Dashboard (Phase 3)
- New "Functions" tab in Monitor ‚Üí Firebase
- Summary cards: active/total functions, 24h error count, last deploy time
- Functions table: name, status badge (ACTIVE/green, deploying/amber, error/red),
  runtime, memory, 24h error count, last deploy time
- Health ping: POST to each function's HTTPS endpoint, reports status + response time
  - 4xx = healthy (auth error but function is alive), 5xx = broken
  - Ping All button tests every function sequentially
- Error counts fetched from Cloud Logging API grouped by function name

FEATURE: Log Viewer (Phase 3)
- New "Logs" tab in Monitor ‚Üí Firebase
- Filters: severity level, function name, free-text search, page size (25-200)
- Auto-refresh toggle with 30-second interval
- Severity summary bar with clickable counts for quick filtering
- Color-coded log entries: timestamp, severity badge, function name, payload
- Click any function name in a log entry to filter to that function
- Supports both textPayload and jsonPayload formats
- Error/Critical entries highlighted with red background

REFACTOR: FirebaseView now has 4 tabs
- Data Browser | Rules | Functions | Logs

v8.10.0 ‚Äî 2025-02-07
--------------------
FEATURE: Firebase Security Rules Manager (Phase 2)
- New Rules tab in Monitor ‚Üí Firebase (alongside existing Data Browser)
- Fetch and display current RTDB security rules as formatted JSON
- Size and line count stats displayed on rules viewer
- Inline editor with Tab key support and real-time JSON validation
- Format/prettify button to clean up edited JSON
- Deploy rules to Firebase with confirmation dialog
  - Shows path count, warns about overwrite
  - Automatically snapshots current rules before deploying
- Rules history stored in localStorage (cc_rulesHistory, last 20 snapshots)
- Manual snapshot button to save current state without deploying
- Snapshot viewer with raw JSON display
- Line-by-line diff view: compare any snapshot against current live rules
- Restore from snapshot: loads into editor, requires explicit Deploy to push
- Delete individual snapshots from history
- Graceful handling when service account not configured (shows setup prompt)

REFACTOR: FirebaseView tabbed layout
- FirebaseView now has two tabs: Data Browser | Rules
- FirebaseDataBrowser extracted from original FirebaseView (no functionality changes)
- Tab switching preserves state within each tab

v8.9.0 ‚Äî 2025-02-07
--------------------
FEATURE: Firebase Admin Token Management (Phase 1)
- New FirebaseAdmin class for Google OAuth2 service account authentication
- Service account JSON key stored in localStorage (cc_firebase_sa)
- JWT signing using browser-native Web Crypto API (RS256 / RSASSA-PKCS1-v1_5)
- Signed JWT exchanged for Google OAuth2 access token (1-hour lifetime)
- Token cached in memory with automatic 55-minute refresh window
- Admin API methods ready for Phase 2-3:
  - getRules() / putRules() ‚Äî Read/deploy RTDB security rules
  - listFunctions() ‚Äî List Cloud Functions and status
  - getLogs() ‚Äî Query Cloud Logging entries
  - testConnection() ‚Äî 3-point validation (token, rules, functions)

UI: Firebase Admin Settings (in Configure ‚Üí Settings)
- Paste service account JSON key with validation (checks type, required fields, key format)
- Status display: service account email, project ID, key ID, token state
- Token state indicator: active (green), expired (amber), not yet requested (grey)
- Test Connection: validates OAuth2 token exchange, RTDB rules access, Cloud Functions API
- Refresh Token: force new token (useful after scope/permission changes)
- Update Key: replace existing service account key
- Remove: clear service account from localStorage

INFRASTRUCTURE:
- Global firebaseAdmin singleton instance available to all components
- No external dependencies ‚Äî all crypto handled by browser SubtleCrypto
- Base64url encoding for JWT components
- PEM key parsing (handles both RSA PRIVATE KEY and PRIVATE KEY formats)

DOCS: Design Decisions Documented (discussed but not yet implemented)
- Priority 1: Projects as stored data ‚Äî promote DEFAULT_PROJECTS to cc_config_v3.projects
  with ConfigManager migration and Project Edit Modal (create/edit/delete)
- Priority 2: App creation consolidation ‚Äî merge Setup New App wizard into Projects view,
  remove standalone nav entry, pre-fill project context on "Add App"
- Priority 3: Firebase-per-app metadata ‚Äî new firebasePaths field on app definitions
  to formally link apps with their Firebase RTDB paths
- Firebase capabilities gap analysis ‚Äî documented what FirebaseView has vs what's missing
  (rules editor, functions dashboard, schema map, per-app paths, multi-project support)

v8.8.0 ‚Äî 2025-02-07
--------------------
FEATURE: Project Layer
- Added project-based grouping for all apps (replaces Public/Internal/Other categories)
- 5 default projects: Game Shelf, Quotle.info, LabelKeeper, Super Bowl, Standalone
- Dashboard: collapsible project cards with color-coded borders, auto-expand on active deploy
- New standalone Projects view (Configure ‚Üí Projects) replaces old Apps view
- Timestamp tracking (createdAt/updatedAt) on all apps
- SB Squares app added under Super Bowl project

FEATURE: Setup New App Wizard
- 4-step wizard: define ‚Üí check repos ‚Üí create ‚Üí Claude prompt

v8.7.7 ‚Äî 2025-02-07
--------------------
FEATURE: Quotle.info Integration
- Added quotle-info and quotle-info-admin app definitions

v8.7.6 ‚Äî prior
--------------------
(See previous release notes for earlier versions)
